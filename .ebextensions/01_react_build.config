option_settings:
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "npm start"
    NodeVersion: 18
    ProxyServer: nginx
    GzipCompression: true
  
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx

  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    PORT: 8080

container_commands:
  01_install_dependencies:
    command: "npm install"
    cwd: "/var/app/staging"
  
  02_build_react_app:
    command: "npm run build"
    cwd: "/var/app/staging"
  
  03_install_serve:
    command: "npm install -g serve"
    cwd: "/var/app/staging"
  
  04_update_package_json:
    command: |
      echo '{
        "name": "react-auth-demo",
        "version": "1.0.0",
        "scripts": {
          "start": "serve -s build -l 8080"
        },
        "dependencies": {
          "serve": "^14.2.1"
        }
      }' > package.json
    cwd: "/var/app/staging"
